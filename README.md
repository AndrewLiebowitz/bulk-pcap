# Tshark Protocol Hierarchy Statistics Batch Processor

## Description

This Bash script automates the process of generating Protocol Hierarchy Statistics (`io,phs`) for packet capture files (like `.pcap`, `.pcapng`) located in specific subdirectories within a base directory, which is expected to be a mounted SMB share.

For each file found directly within the specified subdirectories (defaulting to directories named `1` through `7`), the script runs `tshark` to extract the protocol hierarchy statistics and saves the output to a corresponding text file (e.g., `capture.pcap` -> `capture.pcap.txt`) in the same directory.

## Prerequisites

1.  **Bash Shell:** A standard Linux/macOS/WSL environment with Bash.
2.  **`tshark`:** The command-line utility for Wireshark. This script relies heavily on it.
    * You can usually install it as part of the Wireshark package or a specific command-line package. Examples:
        * Debian/Ubuntu: `sudo apt update && sudo apt install tshark`
        * Fedora/CentOS/RHEL: `sudo dnf install wireshark-cli` or `sudo yum install wireshark-cli`
        * macOS (using Homebrew): `brew install wireshark`
    * During installation (especially on Debian/Ubuntu), `tshark` might ask if non-superusers should be allowed to capture packets. While this script *reads* files rather than capturing live traffic, ensure `tshark` is runnable by the user executing the script.
3.  **Mounted SMB Share:** The network share specified in the `BASE_DIR` variable must be mounted and accessible by the user running the script *before* the script is executed.

## Configuration

Before running the script, you **must** configure the following variables within the script file:

1.  **`BASE_DIR`**:
    * **Purpose:** Sets the path to the base directory containing the numbered subdirectories with packet capture files.
    * **Default:** `/run/user/$(id -u)/gvfs/smb-share:server=nas1,share=bravoshare/pcaps/` (Common path for GVFS mounts)
    * **Action Required:** **Verify this path on your system!** Mount points can differ. Use commands like `df -h` or `mount | grep cifs` (or `mount | grep gvfs`) to find the exact path where `nas1/bravoshare` is mounted. Update the `BASE_DIR` variable in the script accordingly. Alternative common patterns are provided in the script's comments (e.g., `/run/media/...`, or a direct `/mnt/...` path if manually mounted).

2.  **`SUBDIRS_TO_PROCESS`**:
    * **Purpose:** Defines which subdirectories (by name) within `BASE_DIR` should be processed.
    * **Default:** `({1..7})` (Processes subdirectories named `1`, `2`, `3`, `4`, `5`, `6`, `7`)
    * **Action Required (Optional):** Modify this array if you need to process different subdirectories. Examples:
        * Process only directories 1, 3, and 5: `SUBDIRS_TO_PROCESS=(1 3 5)`
        * Process directories 8 through 10: `SUBDIRS_TO_PROCESS=({8..10})`

## Usage

1.  **Save the script:** Save the script content to a file, for example, `process_pcaps.sh`.
2.  **Configure:** Edit the script file (`process_pcaps.sh`) and set the `BASE_DIR` and optionally `SUBDIRS_TO_PROCESS` variables correctly for your environment (see Configuration section above).
3.  **Make executable:** Open your terminal and grant execute permissions to the script:
    ```bash
    chmod +x process_pcaps.sh
    ```
4.  **Run the script:** Execute the script from your terminal:
    ```bash
    ./process_pcaps.sh
    ```
5.  **Monitor Output:** The script will print progress messages, indicating which directory and file it is currently processing. It will also report warnings if subdirectories are not found or if `tshark` encounters an error for a specific file.

## Functionality Details

* **Directory Iteration:** The script loops through the numbers defined in the `SUBDIRS_TO_PROCESS` array.
* **File Discovery:** For each specified subdirectory, it uses `find ... -maxdepth 1 -type f` to locate files *directly* within that subdirectory. It does **not** process files in nested sub-subdirectories.
* **`tshark` Command:** For each discovered file (`input_file`), it runs the following command:
    ```bash
    tshark -r "$input_file" -q -z io,phs > "$output_file"
    ```
    * `-r "$input_file"`: Reads packet data from the specified input file.
    * `-q`: Quiet mode. Suppresses the writing of packet summary information to standard output during processing, making the output cleaner for redirection.
    * `-z io,phs`: Calculates and prints Protocol Hierarchy Statistics after processing the file. This is the core data being extracted.
    * `> "$output_file"`: Redirects the standard output (which contains the statistics table generated by `-z io,phs`) to the output file.
* **Output Files:** The output text file containing the statistics is named by appending `.txt` to the original filename (e.g., `input.pcap` becomes `input.pcap.txt`). The output file is created in the **same directory** as the input file.
* **Overwriting:** If an output file with the target name already exists (e.g., `input.pcap.txt`), it will be **overwritten** without warning.
* **Error Handling:**
    * Checks if the configured `BASE_DIR` exists and is a directory. Exits if not found.
    * Checks if the `tshark` command is available in the system's PATH. Exits if not found.
    * Prints a warning and skips if a specific subdirectory listed in `SUBDIRS_TO_PROCESS` does not exist.
    * Checks the exit status of the `tshark` command for each file. If `tshark` fails (returns a non-zero exit status), a warning is printed, but the script continues with the next file.

## License

(Optional: Add a license if you wish, e.g., MIT License)
